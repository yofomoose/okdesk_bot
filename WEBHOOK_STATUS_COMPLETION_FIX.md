# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –ó–ê–ü–†–û–°–û–ú –û–¶–ï–ù–ö–ò –ü–†–ò –ü–ï–†–ï–•–û–î–ï –ú–ï–ñ–î–£ –ó–ê–í–ï–†–®–ê–Æ–©–ò–ú–ò –°–¢–ê–¢–£–°–ê–ú–ò

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏ —Å "–†–µ—à–µ–Ω–∞" –Ω–∞ "–ó–∞–∫—Ä—ã—Ç–∞" (–∏–ª–∏ –º–µ–∂–¥—É –¥—Ä—É–≥–∏–º–∏ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏) –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–∏—á–∏–Ω–∞ 1: –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
–í `handle_status_changed` –±—ã–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:
```python
if normalized_new_status == issue.status:
    print(f"‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ {issue_id} –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è: {issue.status}")
    return
```

–≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –≤ –ë–î —É–∂–µ –±—ã–ª –æ–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–µ–¥—ã–¥—É—â–∏–º webhook'–æ–º.

### –ü—Ä–∏—á–∏–Ω–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ü–µ–Ω–∫–∏
–ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, –±—ã–ª–∞ –ª–∏ –∑–∞—è–≤–∫–∞ —É–∂–µ –æ—Ü–µ–Ω–µ–Ω–∞, —á—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–∞–º –æ—Ü–µ–Ω–∫–∏.

### –ü—Ä–∏—á–∏–Ω–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ "–∏–∑–º–µ–Ω–µ–Ω–∏–∏" —Å—Ç–∞—Ç—É—Å–∞, –Ω–æ –Ω–µ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–µ—Ä—à–∞—é—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

**–ë—ã–ª–æ:**
```python
if normalized_new_status == issue.status:
    print(f"‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ {issue_id} –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è: {issue.status}")
    return
```

**–°—Ç–∞–ª–æ:**
```python
status_actually_changed = normalized_new_status != issue.status
new_status_is_completion = normalized_new_status.lower() in config.RATING_REQUEST_STATUSES or any(s in normalized_new_status.lower() for s in config.RATING_REQUEST_STATUSES)

if status_actually_changed or new_status_is_completion:
    await notify_user_status_change(updated_issue, normalized_new_status, normalized_old_status)
```

–¢–µ–ø–µ—Ä—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –µ—Å–ª–∏:
- –°—Ç–∞—Ç—É—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª—Å—è, –ò–õ–ò
- –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å —è–≤–ª—è–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–∞—é—â–∏–º (–¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è" –≤ –ë–î)

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```python
if needs_rating and issue.rating is not None:
    print(f"‚≠ê –û–¶–ï–ù–ö–ê –ü–†–û–ü–£–©–ï–ù–ê: –∑–∞—è–≤–∫–∞ —É–∂–µ –±—ã–ª–∞ –æ—Ü–µ–Ω–µ–Ω–∞ ({issue.rating}/5)")
    needs_rating = False
```

–¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ –∑–∞—è–≤–∫–∞ —É–∂–µ –±—ã–ª–∞ –æ—Ü–µ–Ω–µ–Ω–∞, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```python
print(f"üîç status_actually_changed: {status_actually_changed}")
print(f"üîç new_status_is_completion: {new_status_is_completion}")
print(f"   ‚≠ê issue.rating: {issue.rating}")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–ü–µ—Ä–µ—Ö–æ–¥ –≤ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π —Å—Ç–∞—Ç—É—Å:**
   - `in_progress` ‚Üí `resolved` ‚Üí ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏
   - `in_progress` ‚Üí `closed` ‚Üí ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏

2. **–ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –∑–∞–≤–µ—Ä—à–∞—é—â–∏–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏:**
   - `resolved` ‚Üí `closed` ‚Üí ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ (–¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è")
   - `completed` ‚Üí `closed` ‚Üí ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏

3. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ webhook:**
   - –¢–æ—Ç –∂–µ —Å—Ç–∞—Ç—É—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ ‚Üí ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (—Å—Ç–∞—Ç—É—Å –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π)
   - –£–∂–µ –æ—Ü–µ–Ω–µ–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞ ‚Üí ‚ùå –ó–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è

4. **–ù–µ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã:**
   - `new` ‚Üí `in_progress` ‚Üí ‚ùå –ó–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

## üìä –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `webhook_server.py`
- üîÑ –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ `handle_status_changed`
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ –≤ `notify_user_status_change`
- ‚ûï –£–ª—É—á—à–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **üéØ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–∞—é—â–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤** - –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π —Å—Ç–∞—Ç—É—Å
2. **üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ü–µ–Ω–∫–∏ –¥–ª—è —É–∂–µ –æ—Ü–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
3. **üîç –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—à–µ–Ω–∏–π
4. **üìà –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã—Ö webhook –æ—Ç Okdesk

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ webhook —Å–µ—Ä–≤–µ—Ä–∞:
–ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üîç status_actually_changed: False
üîç new_status_is_completion: True
‚≠ê –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'closed':
   ‚≠ê issue.rating: None
   ‚úÖ needs_rating: True
‚≠ê –î–û–ë–ê–í–õ–Ø–ï–ú –ó–ê–ü–†–û–° –û–¶–ï–ù–ö–ò –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'closed'
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –≤ Okdesk
2. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∞ "–†–µ—à–µ–Ω–∞" - –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏
3. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∞ "–ó–∞–∫—Ä—ã—Ç–∞" - –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ü–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ª—é–±–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –∑–∞—è–≤–∫–∏ –≤ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π —Å—Ç–∞—Ç—É—Å (resolved, closed, completed –∏ –∏—Ö —Ä—É—Å—Å–∫–∏–µ –∞–Ω–∞–ª–æ–≥–∏) —Å–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–∏—Ö–æ–¥–∞ webhook'–æ–≤ –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö! üéØ

–°–∏—Å—Ç–µ–º–∞ —Ç–∞–∫–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É–∂–µ –æ—Ü–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —Å–ø–∞–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –æ—Ü–µ–Ω–∫–∏.