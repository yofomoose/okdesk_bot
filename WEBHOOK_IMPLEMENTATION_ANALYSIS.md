# üîç –ê–ù–ê–õ–ò–ó –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò OKDESK WEBHOOK

## üìã –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

### ‚úÖ **–°–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º:**

| –°–æ–±—ã—Ç–∏–µ | –ù–∞—à –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ | –°—Ç–∞—Ç—É—Å |
|---------|----------------|--------|
| `new_ticket` | `handle_issue_created` | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| `new_ticket_status` | `handle_status_changed` | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| `new_comment` | `handle_comment_created` | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |

### üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–∞:**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
```yaml
status:
  code: string # opened|in_progress|completed|closed
  name: string

old_status:
  code: string
  name: string
```

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ–º –æ–±–∞ –ø–æ–ª—è
new_status = (
    new_status_raw.get("code") or
    new_status_raw.get("name") or
    str(new_status_raw)
)

old_status = (
    old_status_raw.get("code") or
    old_status_raw.get("name") or
    str(old_status_raw)
)
```
‚úÖ **–ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**

### üéØ **–ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤:**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã:** `["opened", "in_progress", "completed", "closed"]`

**–ù–∞—à –º–∞–ø–ø–∏–Ω–≥:**
```python
OKDESK_STATUS_MAPPING = {
    "opened": "opened",
    "in_work": "in_progress",  # –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –Ω–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è
    "waiting": "on_hold",
    "resolved": "resolved",    # –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π
    "closed": "closed",
    "completed": "completed",
    # –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    "–†–µ—à–µ–Ω–∞": "resolved",
    "–ó–∞–∫—Ä—ã—Ç–∞": "closed",
    "–í—ã–ø–æ–ª–Ω–µ–Ω–∞": "completed",
    # ...
}
```
‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**

### ‚≠ê **–ó–∞–≤–µ—Ä—à–∞—é—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏:**

**–ù–∞—à–∞ –ª–æ–≥–∏–∫–∞:**
```python
RATING_REQUEST_STATUSES = [
    "resolved", "closed", "completed", "done", "finished", "solved",
    "solved", "complete", "finish", "close",
    # –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    "—Ä–µ—à–µ–Ω–∞", "—Ä–µ—à–µ–Ω–æ", "–∑–∞–∫—Ä—ã—Ç–∞", "–∑–∞–∫—Ä—ã—Ç–æ", "–≤—ã–ø–æ–ª–Ω–µ–Ω–∞", "–≤—ã–ø–æ–ª–Ω–µ–Ω–æ",
    "–∑–∞–≤–µ—Ä—à–µ–Ω–∞", "–∑–∞–≤–µ—Ä—à–µ–Ω–æ", "–≥–æ—Ç–æ–≤–æ", "–∑–∞–≤–µ—Ä—à–µ–Ω", "—Ä–µ—à–µ–Ω"
]
```

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã:** `["completed", "closed"]`

‚úÖ **–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã**

### üí¨ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```yaml
new_comment:
  event_type: "new_comment"
  author: person_structure
  comment:
    id: string
    is_public: boolean
    content: string
  attachments: [attachment_structure]
```

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã webhook
issue_data = data.get("issue", {})
comment_data = event_data.get("comment", {})
author_data = event_data.get("author", {})

# –ü–æ–ª—É—á–∞–µ–º ID –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
issue_id = issue_data.get("id")
comment_id = comment_data.get("id")
content = comment_data.get("content")
is_public = comment_data.get("is_public", False)
```
‚úÖ **–ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**

### üîÑ **Webhook —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è:** `{event: event_data, issue: common_structure}`

**–ù–∞—à–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
# –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö
event_data = data.get("event", data)
issue_data = data.get("issue", event_data)
```
‚úÖ **–ì–∏–±–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤**

### üìà **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ HTML –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö** ‚úÖ
2. **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤** ‚úÖ  
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫** ‚úÖ
4. **–ì–∏–±–∫–∞—è –ª–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** ‚úÖ
5. **–ü–æ–¥—Ä–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞** ‚úÖ

### üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:**

1. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö —Å–æ–±—ã—Ç–∏–π:**
   - `new_csat_rate` - –æ—Ü–µ–Ω–∫–∏ –æ—Ç Okdesk
   - `new_files` - –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
   - `new_deadline` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤

2. **–£–ª—É—á—à–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤:**
   - –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `reopened`, `pending` –∏ —Ç.–¥.

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É:**
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å—Ö–µ–º–µ
   - –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### ‚úÖ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Okdesk webhook'–æ–≤ –∏ **—Ä–∞—Å—à–∏—Ä–µ–Ω–∞** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö. –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Å–∏—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–æ—Ü–µ–Ω–∫–∏, HTML –æ—á–∏—Å—Ç–∫–∞, –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å) –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –∏ —É–¥–æ–±–Ω–æ–π.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£**