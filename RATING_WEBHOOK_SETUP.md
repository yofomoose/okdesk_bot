# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook'–æ–≤ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–æ–∫ –∑–∞—è–≤–æ–∫

## –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ "—Ä–µ—à–µ–Ω–∞" (resolved), "–∑–∞–∫—Ä—ã—Ç–∞" (closed) –∏–ª–∏ "–≤—ã–ø–æ–ª–Ω–µ–Ω–∞" (completed), —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **üîî –£–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —á–µ—Ä–µ–∑ Telegram –±–æ—Ç –æ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
2. **‚≠ê –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ—Ü–µ–Ω–∫—É** –∫–∞—á–µ—Å—Ç–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã (–æ—Ç 1 –¥–æ 5 –∑–≤–µ–∑–¥)
3. **üíæ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ü–µ–Ω–∫—É** –≤ –≤–∏–¥–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –∑–∞—è–≤–∫–µ –≤ Okdesk
4. **üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –æ—Ü–µ–Ω–æ–∫ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–∏—Å–∞

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook'–æ–≤ –≤ Okdesk

### 1. –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å Okdesk

1. –í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –ø–æ—Ä—Ç–∞–ª Okdesk –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Üí **Webhook'–∏**

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ webhook'–∞

–°–æ–∑–¥–∞–π—Ç–µ webhook —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

**–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **URL**: `https://–≤–∞—à-–¥–æ–º–µ–Ω/okdesk-webhook` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://okbot.teftelyatun.ru/okdesk-webhook`)
- **–ú–µ—Ç–æ–¥**: `POST`
- **–§–æ—Ä–º–∞—Ç**: `JSON`

**–°–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è:

‚úÖ **issue.status_changed** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏ (–æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ)
‚úÖ **issue.updated** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ (—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ)
‚úÖ **comment.created** - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã)

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Secret Key** –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ webhook'–æ–≤
- –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `WEBHOOK_SECRET`

**–§–∏–ª—å—Ç—Ä—ã —Å–æ–±—ã—Ç–∏–π:**
- –°—Ç–∞—Ç—É—Å—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –æ—Ü–µ–Ω–∫–∏: `resolved`, `closed`, `completed`, `done`, `finished`
- –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø–∞–º –∑–∞—è–≤–æ–∫ –∏–ª–∏ –≥—Ä—É–ø–ø–∞–º

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö webhook'–∞ –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞

```json
{
  "event": {
    "event_type": "issue.status_changed"
  },
  "issue": {
    "id": 1380,
    "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏",
    "status": {
      "code": "resolved",
      "name": "–†–µ—à–µ–Ω–∞"
    },
    "old_status": {
      "code": "opened", 
      "name": "–û—Ç–∫—Ä—ã—Ç–∞"
    },
    "client": {
      "contact": {
        "id": 95
      },
      "company": {
        "id": 147
      }
    }
  }
}
```

## –°—Ç–∞—Ç—É—Å—ã, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–∏–µ –æ—Ü–µ–Ω–∫—É

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ—Ü–µ–Ω–∫—É –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞:

- `resolved` - –†–µ—à–µ–Ω–∞
- `closed` - –ó–∞–∫—Ä—ã—Ç–∞  
- `completed` - –í—ã–ø–æ–ª–Ω–µ–Ω–∞
- `done` - –í—ã–ø–æ–ª–Ω–µ–Ω–∞
- `finished` - –ó–∞–≤–µ—Ä—à–µ–Ω–∞
- `solved` - –†–µ—à–µ–Ω–∞

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
# Webhook Configuration
WEBHOOK_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω/okdesk-webhook
WEBHOOK_PATH=/okdesk-webhook
WEBHOOK_SECRET=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á

# Okdesk API Configuration  
OKDESK_API_URL=https://–≤–∞—à-–ø–æ–¥–¥–æ–º–µ–Ω.okdesk.ru/api/v1/
OKDESK_API_TOKEN=–≤–∞—à-api-—Ç–æ–∫–µ–Ω
OKDESK_PORTAL_URL=https://–≤–∞—à-–ø–æ–¥–¥–æ–º–µ–Ω.okdesk.ru
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook'–æ–≤

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint'–∞

```bash
curl -X GET https://–≤–∞—à-–¥–æ–º–µ–Ω/okdesk-webhook
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{"message": "Webhook endpoint is ready", "path": "/okdesk-webhook"}
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞

```bash
python test_issue_rating.py
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö

–õ–æ–≥–∏ webhook'–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
docker logs okdesk_webhook_1 -f
```

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ä–µ—à–∞–µ—Ç –∑–∞—è–≤–∫—É** –≤ Okdesk –∏ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "–†–µ—à–µ–Ω–∞"
2. **Okdesk –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook** —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
3. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç webhook** –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –≤ Telegram —Å –∫–Ω–æ–ø–∫–∞–º–∏ –æ—Ü–µ–Ω–∫–∏:
   - ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–æ (5)
   - ‚≠ê‚≠ê‚≠ê‚≠ê –•–æ—Ä–æ—à–æ (4)  
   - ‚≠ê‚≠ê‚≠ê –ù–æ—Ä–º–∞–ª—å–Ω–æ (3)
   - ‚≠ê‚≠ê –ü–ª–æ—Ö–æ (2)
   - ‚≠ê –£–∂–∞—Å–Ω–æ (1)
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ—Ü–µ–Ω–∫—É**, –æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Okdesk –∫–∞–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
6. **–°–∏—Å—Ç–µ–º–∞ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### Webhook'–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL webhook'–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Okdesk
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞ –∏ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞—è–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram

### –û—Ü–µ–Ω–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API —Ç–æ–∫–µ–Ω Okdesk
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook —Å–µ—Ä–≤–µ—Ä–∞

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫
- –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –æ—Ü–µ–Ω–∫–∞–º
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –∑–∞—è–≤–∫–∏
- –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.