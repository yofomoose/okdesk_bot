# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –ó–ê–ü–†–û–°–û–ú –û–¶–ï–ù–ö–ò –ü–†–ò –ó–ê–ö–†–´–¢–ò–ò –ó–ê–Ø–í–û–ö

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ "—Ä–µ—à–µ–Ω–∞" –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–∏—á–∏–Ω–∞ 1: –ù–µ–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –æ—Ü–µ–Ω–∫–∏
–í `config.RATING_REQUEST_STATUSES` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç Okdesk –≤ –ø–æ–ª–µ `name`.

### –ü—Ä–∏—á–∏–Ω–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
Webhook —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–ª —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `code` —Å—Ç–∞—Ç—É—Å–∞, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –ø–æ–ª–µ `name`, –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è.

### –ü—Ä–∏—á–∏–Ω–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–ª–∞–¥–∫–∏
–ù–µ –±—ã–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ü–µ–Ω–∫–∏.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –æ—Ü–µ–Ω–∫–∏

**–ë—ã–ª–æ:**
```python
RATING_REQUEST_STATUSES = [
    "resolved", "closed", "completed", "done", "finished", "solved",
    "solved", "complete", "finish", "close"
]
```

**–°—Ç–∞–ª–æ:**
```python
RATING_REQUEST_STATUSES = [
    "resolved", "closed", "completed", "done", "finished", "solved",
    "solved", "complete", "finish", "close",
    # –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
    "—Ä–µ—à–µ–Ω–∞", "—Ä–µ—à–µ–Ω–æ", "–∑–∞–∫—Ä—ã—Ç–∞", "–∑–∞–∫—Ä—ã—Ç–æ", "–≤—ã–ø–æ–ª–Ω–µ–Ω–∞", "–≤—ã–ø–æ–ª–Ω–µ–Ω–æ",
    "–∑–∞–≤–µ—Ä—à–µ–Ω–∞", "–∑–∞–≤–µ—Ä—à–µ–Ω–æ", "–≥–æ—Ç–æ–≤–æ", "–∑–∞–≤–µ—Ä—à–µ–Ω", "—Ä–µ—à–µ–Ω"
]
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

**–î–æ–±–∞–≤–ª–µ–Ω—ã —Ä—É—Å—Å–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
```python
OKDESK_STATUS_MAPPING = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞–ø–ø–∏–Ω–≥–∏ ...
    # –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
    "–†–µ—à–µ–Ω–∞": "resolved",
    "–ó–∞–∫—Ä—ã—Ç–∞": "closed", 
    "–í—ã–ø–æ–ª–Ω–µ–Ω–∞": "completed",
    "–ó–∞–≤–µ—Ä—à–µ–Ω–∞": "completed",
    "–†–µ—à–µ–Ω–æ": "resolved",
    "–ó–∞–∫—Ä—ã—Ç–æ": "closed",
    "–í—ã–ø–æ–ª–Ω–µ–Ω–æ": "completed",
    "–ó–∞–≤–µ—Ä—à–µ–Ω–æ": "completed"
}
```

### 3. –£–ª—É—á—à–µ–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

**–ë—ã–ª–æ:**
```python
new_status = new_status_raw.get("code", new_status_raw.get("name", str(new_status_raw)))
```

**–°—Ç–∞–ª–æ:**
```python
new_status = (
    new_status_raw.get("code") or
    new_status_raw.get("name") or
    str(new_status_raw)
)
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–µ—Ç—Å—è `code`, –Ω–æ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `name`.

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ü–µ–Ω–∫–∏:
```python
print(f"‚≠ê –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ '{new_status}':")
print(f"   üìã RATING_REQUEST_STATUSES: {config.RATING_REQUEST_STATUSES}")
print(f"   üîç new_status.lower(): '{new_status.lower()}'")
print(f"   ‚úÖ needs_rating: {needs_rating}")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

**–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã:**
- ‚úÖ `resolved` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞
- ‚úÖ `closed` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞  
- ‚úÖ `completed` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞

**–†—É—Å—Å–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã:**
- ‚úÖ `–†–µ—à–µ–Ω–∞` ‚Üí `resolved` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞
- ‚úÖ `–ó–∞–∫—Ä—ã—Ç–∞` ‚Üí `closed` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞
- ‚úÖ `–í—ã–ø–æ–ª–Ω–µ–Ω–∞` ‚Üí `completed` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞

**Webhook –¥–∞–Ω–Ω—ã–µ:**
- ‚úÖ `{"code": "resolved", "name": "–†–µ—à–µ–Ω–∞"}` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞
- ‚úÖ `{"name": "–†–µ—à–µ–Ω–∞"}` ‚Üí –û—Ü–µ–Ω–∫–∞: –î–∞ (fallback –Ω–∞ name)

## üìä –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `config.py`
- ‚ûï –†–∞—Å—à–∏—Ä–µ–Ω—ã `RATING_REQUEST_STATUSES` —Ä—É—Å—Å–∫–∏–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä—É—Å—Å–∫–∏–µ –º–∞–ø–ø–∏–Ω–≥–∏ –≤ `OKDESK_STATUS_MAPPING`

### `webhook_server.py`
- üîÑ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ (code –∏–ª–∏ name)
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏

### `test_rating_logic.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
- üß™ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **üéØ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö, —Ç–∞–∫ –∏ —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
2. **üîç –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. **üõ°Ô∏è Fallback –ª–æ–≥–∏–∫–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ name –±–µ–∑ code
4. **üìà –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ç–∞—Ç—É—Å–æ–≤

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞:
```bash
python test_rating_logic.py
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ webhook —Å–µ—Ä–≤–µ—Ä–∞:
–ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
‚≠ê –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'resolved':
   üìã RATING_REQUEST_STATUSES: [...]
   üîç new_status.lower(): 'resolved'
   ‚úÖ needs_rating: True
‚≠ê –î–û–ë–ê–í–õ–Ø–ï–ú –ó–ê–ü–†–û–° –û–¶–ï–ù–ö–ò –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'resolved'
```

### 3. –†–µ–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –≤ Okdesk
2. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∞ "–†–µ—à–µ–Ω–∞"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram —Å –∫–Ω–æ–ø–∫–∞–º–∏ –æ—Ü–µ–Ω–∫–∏

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ª—é–±–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ —É–∫–∞–∑–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ ("resolved", "–†–µ—à–µ–Ω–∞", "closed", "–ó–∞–∫—Ä—ã—Ç–∞" –∏ —Ç.–¥.) —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ –æ—Ü–µ–Ω–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é! üéØ