# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è –±–æ—Ç–∞

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: handler not found –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–∏—â–∞–ª–æ—Å—å —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, –∏–∑-–∑–∞ —á–µ–≥–æ –±–æ—Ç –Ω–µ –º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –ò–ù–ù.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 
- –£–¥–∞–ª–µ–Ω `await state.clear()` –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ –≤ `handlers/registration.py` (—Å—Ç—Ä–æ–∫–∞ 164)
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –æ—á–∏—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã inline-–∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
**–£–ª—É—á—à–µ–Ω–∏–µ:** –¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∫–∞–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö, —Ç–∞–∫ –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:
- üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
- üìã –ú–æ–∏ –∑–∞—è–≤–∫–∏  
- üë§ –ü—Ä–æ—Ñ–∏–ª—å

### 3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º –æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
**–£–ª—É—á—à–µ–Ω–∏–µ:** –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –∑–∞—è–≤–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫–∏:
- üìù –û—Ç–≤–µ—Ç–∏—Ç—å (–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞—è–≤–∫—É)
- üìã –ú–æ–∏ –∑–∞—è–≤–∫–∏
- üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É

### 4. ‚úÖ –£–ª—É—á—à–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—Ç–≤–µ—Ç–∏—Ç—å"
**–£–ª—É—á—à–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `add_comment_start` —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å ID –∑–∞—è–≤–∫–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∏ —Å –Ω–æ–º–µ—Ä–æ–º –∑–∞—è–≤–∫–∏, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ webhook.

### 5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –º–µ—Ç–æ–¥ `get_issue_by_id`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_issue_by_id` –≤ `IssueService` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞—è–≤–æ–∫ –ø–æ ID.

### 6. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏–º–µ–Ω –ø–æ–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–¥–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –º–µ—Ç–æ–¥–æ–≤ –ø–æ–∏—Å–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –ø–æ–ª–µ `okdesk_company_id`, –Ω–æ –≤ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `company_id`. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–µ–Ω—ã SQL-–∑–∞–ø—Ä–æ—Å—ã —Å `okdesk_company_id IS NULL` –Ω–∞ `company_id IS NULL`
- –ó–∞–º–µ–Ω–µ–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å `UPDATE users SET okdesk_company_id = ?` –Ω–∞ `UPDATE users SET company_id = ?`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–∞–∑–≤–∞–Ω–∏—é –ø–æ–ª—è –≤ –ë–î

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. `handlers/registration.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
2. `handlers/issues.py` - —É–ª—É—á—à–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
3. `database/crud.py` - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_issue_by_id`
4. `webhook_server.py` - —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª –∫–Ω–æ–ø–∫–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
5. `okdesk_api.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö (okdesk_company_id -> company_id)

## –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. `OKDESK_COMPANY_ID_FIX.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–ª—è–º–∏ –ë–î
2. `test_company_id_fix.py` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. `fix_company_id_fields.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∏–º–µ–Ω –ø–æ–ª–µ–π –≤ –∫–æ–¥–µ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–æ–∏—Å–∫ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –ò–ù–ù —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ò–ù–ù)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ Okdesk —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ID –∫–æ–º–ø–∞–Ω–∏–π –≤ –ø–æ–ª–µ company_id –≤ –ë–î

## –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é:
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å Docker-–æ–∫—Ä—É–∂–µ–Ω–∏–µ–º –∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è git push –∏ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
